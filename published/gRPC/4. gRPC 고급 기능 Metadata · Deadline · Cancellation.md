# **ğŸ¯ 4ì¼ì°¨ í•™ìŠµ ëª©í‘œ**
1. **Metadata(ë©”íƒ€ë°ì´í„°)**
    - RESTì˜ HTTP Headerì²˜ëŸ¼ gRPC ìš”ì²­/ì‘ë‹µì— ë¶€ê°€ ì •ë³´ ì „ë‹¬í•˜ê¸°
    - ì˜ˆ: ì¸ì¦ í† í°(JWT), íŠ¸ë ˆì´ì‹± ID, ì‚¬ìš©ì ID
2. **Deadline, Timeout, ì·¨ì†Œ(Cancellation)**
    - í´ë¼ì´ì–¸íŠ¸ê°€ RPC í˜¸ì¶œ ì‹œ â€œì–¸ì œê¹Œì§€ ê¸°ë‹¤ë¦´ì§€â€ ì„¤ì •í•˜ëŠ” ë°©ë²•
    - ì„œë²„ëŠ” ì´ ì‹œê°„ ì´ˆê³¼ë¥¼ ê°ì§€í•˜ê³  ì‘ì—… ì¤‘ë‹¨ ê°€ëŠ¥
    - í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ì„ ì·¨ì†Œí–ˆì„ ë•Œ ì„œë²„ê°€ ê°ì§€í•˜ëŠ” ë°©ë²•
    - ê¸´ ì²˜ë¦¬ ì‘ì—… ì¤‘ ìì› ë‚­ë¹„ ë°©ì§€

---
# 1. Metadata(ë©”íƒ€ë°ì´í„°)
ë©”íƒ€ë°ì´í„°ë€, gRPCì—ì„œ **HTTP Header**ì™€ ê°™ì€ ì—­í• ì„ í•©ë‹ˆë‹¤.
í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ ìš”ì²­ê³¼ ì‘ë‹µì— ì¶”ê°€ì ì¸ ì •ë³´(key - value)ë¥¼ ë‹´ì•„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ì‚¬ìš© ì˜ˆ
    - ì¸ì¦ í† í° - (Authorization: Bearer â€¦)
    - íŠ¸ë ˆì´ì‹± ID (X-Request-ID)
    - ë‹¤êµ­ì–´/Locale

## 1-2. ë©”íƒ€ë°ì´í„° ì¢…ë¥˜
### í—¤ë”
- ìš”ì²­ í—¤ë”
    - í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„ ì „ì†¡í•  ë•Œ ì‚¬ìš©
    - RPC í˜¸ì¶œ ì‹œì‘ ì‹œ ì „ì†¡
- ì‘ë‹µ í—¤ë”
    - ì„œë²„ -> í´ë¼ì´ì–¸íŠ¸ ì „ì†¡ ì‹œ ì‚¬ìš©
    - ì‘ë‹µ ë³¸ë¬¸ (message)ê°€ ë‚´ë ¤ê°€ê¸° ì „ì— ì „ì†¡ë˜ëŠ” ë©”íƒ€ë°ì´í„°
### íŠ¸ë ˆì¼ëŸ¬
- ì‘ë‹µ ë§ˆì§€ë§‰ì— ì „ì†¡ë˜ëŠ” ë©”íƒ€ë°ì´í„°
- ì£¼ë¡œ ì—ëŸ¬ ì •ë³´, ìƒíƒœ ì½”ë“œ, ì¶”ê°€ ë””ë²„ê¹… ë°ì´í„°ì— ì‚¬ìš©

## 1-3. ë©”íƒ€ë°ì´í„° í‚¤ ì´ë¦„ ê·œì¹™
1. í‚¤ ì´ë¦„ì€ **ì†Œë¬¸ì**ì¼ ê²ƒ
    - ASCII ì†Œë¬¸ì(a-z), ìˆ«ì(0-9), `-`(í•˜ì´í”ˆ) ì‚¬ìš© ê¶Œì¥
    - ëŒ€ë¬¸ì(ex, Authorization), ê³µë°± ì‚¬ìš© ê¸ˆì§€
2. ì˜ˆì•½ ì ‘ë‘ì‚¬ ê¸ˆì§€
    - `:`(ì½œë¡ )ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ì´ë¦„ì€ HTTP/2 ì˜ˆì•½ í—¤ë”, ì»¤ìŠ¤í…€ ë©”íƒ€ë°ì´í„°ë¡œ ì‚¬ìš© ê¸ˆì§€
3. ë°”ì´ë„ˆë¦¬ ê°’ì€ ë°˜ë“œì‹œ `-bin` ì ‘ë¯¸ì‚¬ ì‚¬ìš©
    - `-bin` (ì˜ˆ, authorization-bin) ê°™ì€ í‚¤ë§Œ `BINARY_BYTE_MARSHALLER` ì‚¬ìš© ê°€ëŠ¥
    - í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì „ì†¡í•  ë•ŒëŠ” Base64ë¡œ ì¸ì½”ë”©ëœ ê°’ì´ ë“¤ì–´ê°€ì•¼ í•¨
    - ì„œë²„ì—ì„œ `byte[]`ë¡œ êº¼ë‚¼ ìˆ˜ ìˆìŒ
4. ê¸¸ì´ ì œí•œ
    - í‚¤ ì´ë¦„ : 1~127ë°”ì´íŠ¸ (HTTP/2 í—¤ë” ì œí•œ)
    - ê°’ : 0~8KB ê¶Œì¥ (HTTP/2 í”„ë ˆì„ í¬ê¸° ì œí•œ ë‚´)
5. ì¤‘ë³µ ê°€ëŠ¥
    - ê°™ì€ í‚¤ ì´ë¦„ìœ¼ë¡œ ì—¬ëŸ¬ ê°’ ë³´ë‚´ê¸° ê°€ëŠ¥
        - ì„œì—ì„œ headers.getAll(key) í˜•ì‹ìœ¼ë¡œ ì¡°íšŒ

## 1-4. ì„œë²„ì—ì„œ ë©”íƒ€ë°ì´í„° ì²˜ë¦¬í•˜ê¸°
gRPC ì¸í„°ì…‰í„°ë¥¼ í†µí•´ ë©”íƒ€ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¸í„°ì…‰í„° ë“±ë¡ì„ í•´ì£¼ë ¤ë©´ `@GrpcGlobalServerInterceptor` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ ì‰½ê²Œ ì²˜ë¦¬í•´ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì¸í„°ì…‰í„°ê°€ ì—¬ëŸ¬ ê°œ ìˆë‹¤ë©´, ìˆœì„œ ë³´ì¥ì´ ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì œì–´í•˜ê¸° ìœ„í•´ì„œëŠ” `@Order` ë¥¼ í†µí•´ ì§€ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.

```java
@Order(1)  
@GrpcGlobalServerInterceptor  
public class HelloInterceptor implements ServerInterceptor {  
  
    private static final Metadata.Key<String> METADATA_KEY =  
        Metadata.Key.of("authorization", Metadata.ASCII_STRING_MARSHALLER);  
  
    private static final Set<String> PASS_PATH = Set.of(  
        "kr.co.grpc.hello.UnaryService/callUnary"  
    );  
  
    @Override  
    public <ReqT, RespT> Listener<ReqT> interceptCall(ServerCall<ReqT, RespT> call, Metadata headers,  
        ServerCallHandler<ReqT, RespT> next) {  
  
        final String path = call.getMethodDescriptor().getFullMethodName();  
          
        if (PASS_PATH.contains(path)) {  
            return next.startCall(call, headers);  
        }  
        final String token = headers.get(METADATA_KEY);  
          
        if (!StringUtils.hasText(token)) {  
            call.close(Status.UNAUTHENTICATED.withDescription("í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."), new Metadata());  
            return new ServerCall.Listener<>() {};  
        }  
  
        return next.startCall(call, headers);  
    }  
}
```
- `Metadata.Key<String> METADATA_KEY`
    - gPRC ë©”íƒ€ ë°ì´í„°ì— ì ‘ê·¼í•  ë•Œ ì‚¬ìš©í•˜ëŠ” í‚¤ ê°ì²´
    - "authorization" ì´ë¼ëŠ” í—¤ë” ì´ë¦„ì„ ASCII ë¬¸ìì—´ ë§ˆìƒ¬ëŸ¬ë¥¼ ì´ìš©í•´ ì½ê² ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸
- `Set<String> PASS_PATH`
    - íŠ¹ì • gRPC ë©”ì„œë“œ ì´ë¦„ì„ ì§€ì •
    - í•´ë‹¹ ë©”ì„œë“œëŠ” ê²€ì¦í•˜ì§€ ì•Šê³  ë¬´ì¡°ê±´ íŒ¨ìŠ¤í•˜ê¸° ìœ„í•´êµ¬ì„±
    - í¬ë§·ì€, `íŒ¨í‚¤ì§€.ì„œë¹„ìŠ¤ëª…/ë©”ì„œë“œëª…` í˜•ì‹ìœ¼ë¡œ, gRPC ë‚´ë¶€ì—ì„œ ì“°ëŠ” canonical name
- `interceptCall`
    - ServerInterceptor ì¸í„°í˜ì´ìŠ¤ì˜ í•µì‹¬ ë©”ì„œë“œ
    - í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„ RPC í˜¸ì¶œì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ ì‹¤í–‰ë¨
    - íŒŒë¼ë¯¸í„° ì˜ë¯¸
        - ServerCall<ReqT, RespT> call
            - í˜„ ìš”ì²­ì˜ ì „ì²´ í•¸ë“¤ëŸ¬
        - Metadata headers
            - í´ì´ì–¸íŠ¸ê°€ ë³´ë‚¸ ìš”ì²­ í—¤ë”ë¥¼ ë‹´ì€ ê°ì²´
        - ServerCallHandler<ReqT, RespT> next
            - ì²´ì¸ì˜ ë‹¤ìŒ í•¸ë“¤ëŸ¬ (ì¸í„°ì…‰í„° í˜¹ì€ ì„œë¹„ìŠ¤ êµ¬í˜„ì²´ê°€ ë  ìˆ˜ ìˆìŒ)
- call.getMethodDescriptor().getFullMethodName()
    - í˜„ì¬ í˜¸ì¶œëœ gRPC ë©”ì„œë“œ í’€ ë„¤ì„ì„ ê°€ì ¸ì˜´
- next.startCall(call, headers)
    - ì²´ì¸ì˜ ë‹¤ìŒ ë‹¨ê³„ (ì¸í„°ì…‰í„° í˜¹ì€ ì„œë¹„ìŠ¤ êµ¬í˜„ì²´)ë¡œ RPC ì²˜ë¦¬ë¥¼ ë„˜ê¹€
    - Spring MVCì˜ `filterChain.doFilter()`ì™€ ë¹„ìŠ·í•¨
    - í•´ë‹¹ ë¶€ë¶„ì„ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©´, ì‹¤ì œ ì„œë¹„ìŠ¤ ì½”ë“œê¹Œì§€ ë„ë‹¬í•˜ì§€ ì•ŠìŒ
- headers.get(METADATA_KEY)
    - í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚¸ ìš”ì²­ í—¤ë”ì—ì„œ `authorization` í‚¤ë¥¼ êº¼ëƒ„
    - ì—†ìœ¼ë©´ null, ìˆìœ¼ë©´ ë¬¸ìì—´ë¡œ ë°˜í™˜
- call.close()
    - í˜„ì¬ RPC ìš”ì²­ì„ ì—ëŸ¬ë¡œ ì¦‰ì‹œ ì¢…ë£Œ
    - ì¶”ê°€ íŠ¸ë ˆì¼ëŸ¬ê°€ í•„ìš”í•˜ë‹¤ë©´, íŒŒë¼ë¯¸í„° ë§ˆì§€ë§‰ì— `Metadata`ì— ë„£ì–´ ì „ë‹¬
- new ServerCall.Listener<>() {}
    - ë¹ˆ ë¦¬ìŠ¤ë„ˆë¥¼ ë°˜í™˜í•˜ì—¬ ë” ì´ìƒ ì´ë²¤íŠ¸ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒì„ ì˜ë¯¸
    - í•´ë‹¹ RPC í˜¸ì¶œì€ í•´ë‹¹ ë¶€ë¶„ì—ì„œ ì°¨ë‹¨ë˜ê³ , ì„œë¹„ìŠ¤ êµ¬í˜„ì²´ë¡œ ì „ë‹¬ë˜ì§€ ì•ŠìŒ
- next.startCall(call, headers)
    - í† í°ì´ ì •ìƒì ìœ¼ë¡œ ì¡´ì¬í•˜ë©´ ì²´ì¸ì„ ì´ì–´ì„œ ë‹¤ìŒìœ¼ë¡œ ë„˜ê¹€

## 1-5. ìš”ì²­ í—¤ë” ì„œë¹„ìŠ¤ì—ì„œ í™œìš©í•˜ê¸°
ì„œë¹„ìŠ¤ì—ì„œ ë©”íƒ€ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” `Context` ë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1) ì „ì—­ í‚¤ í´ë˜ìŠ¤ ìƒì„±
```java
public class GrpcContextKeys {  
  
    public static final Context.Key<String> AUTHORIZATION = Context.key("authorization");  
  
    public GrpcContextKeys() {  
    }
}
```
- gRPC ì»¨í…ìŠ¤íŠ¸ì—ì„œ êº¼ë‚´ ì“¸ ìˆ˜ ìˆëŠ” í‚¤ë“¤ì„ ëª¨ì•„ ë‘” ì „ì—­ í‚¤ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

### 2) ì¸í„°ì…‰í„°ì—ì„œ í—¤ë” ì¶”ì¶œ í›„, Contextì— ì €ì¥
```java
@Order(1)  
@GrpcGlobalServerInterceptor  
public class HelloInterceptor implements ServerInterceptor {  
  
    private static final Metadata.Key<String> METADATA_KEY =  
        Metadata.Key.of("authorization", Metadata.ASCII_STRING_MARSHALLER);  
  
    @Override  
    public <ReqT, RespT> Listener<ReqT> interceptCall(ServerCall<ReqT, RespT> call, Metadata headers,  
        ServerCallHandler<ReqT, RespT> next) {  
  
        final Context context = Context.current()  
            .withValue(GrpcContextKeys.AUTHORIZATION, headers.get(METADATA_KEY));  
  
        return Contexts.interceptCall(context, call, headers, next);  
    }  
}
```
- `Context.current()`
    - í˜„ì¬ ìš”ì²­ì˜ gRPC ì»¨í…ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜´
    - ThreadLocalê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ gRPC ë‚´ë¶€ì ìœ¼ë¡œ ê´€ë¦¬ë¨
- `withValue(GrpcContextKeys.AUTHORIZATION, headers.get(METADATA_KEY))`
    - ìƒˆë¡œìš´ íŒŒìƒ Context ìƒì„±
    - ì›ë³¸ ContextëŠ” ê·¸ëŒ€ë¡œ ë‘ê³ , ìƒˆë¡œìš´ Contextì— ì¶”ê°€ ê°’ë§Œ ë¶™ì—¬ì„œ ë°˜í™˜
- `Contexts.interceptCall(context, call, headers, next)`
    - ìƒˆ Contextë¥¼ ì „ì²´ ì²´ì¸ì— ì „íŒŒí•˜ì—¬ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°

### 3) ì„œë¹„ìŠ¤ì—ì„œ ì»¨í…ìŠ¤íŠ¸ í˜¸ì¶œ
```java
@Override  
public void sayHello(HelloRequest request, StreamObserver<HelloResponse> responseObserver) {  
    final String auth = GrpcContextKeys.AUTHORIZATION.get();  
  
    final String message = "ë°˜ê°‘ìŠµë‹ˆë‹¤~ " + auth + "ë‹˜";  
  
    final HelloResponse response = HelloResponse.newBuilder()  
        .setMessage(message)  
        .build();  
  
    responseObserver.onNext(response);  // ì‘ë‹µ ì „ë‹¬  
    responseObserver.onCompleted();     // ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ  
}
```
- `GrpcContextKeys.AUTHORIZATION.get()`
    - í˜„ ìš”ì²­ì˜ ì»¨í…ìŠ¤íŠ¸ì—ì„œ `authorization` í‚¤ì— ì €ì¥ëœ ê°’ í˜¸ì¶œ
### 3) ìš”ì²­
```shell
grpcurl -plaintext -H "authorization: zinzo" localhost:9097 HelloService/SayHello
```
- `-H` ë¥¼ ì´ìš©í•´ ìš”ì²­
##### ì‘ë‹µ
```
{
  "message": "ë°˜ê°‘ìŠµë‹ˆë‹¤~ zinzoë‹˜"
}
```

## 1-6. ì‘ë‹µ í—¤ë” í´ë¼ì´ì–¸íŠ¸ì— ë‚´ë ¤ì£¼ê¸°
### 1) ì‘ë‹µ í—¤ë” ë‚´ë ¤ì£¼ê¸° ìœ„í•œ ì¸í„°ì…‰í„° ìƒì„±
```java
@Order  
@GrpcGlobalServerInterceptor  
public class ResponseHeaderInterceptor implements ServerInterceptor {  
  
    private static final Metadata.Key<String> SERVER_HEADER =  
        Metadata.Key.of("x-server", Metadata.ASCII_STRING_MARSHALLER);  
  
    @Override  
    public <ReqT, RespT> Listener<ReqT> interceptCall(ServerCall<ReqT, RespT> call, Metadata headers,  
        ServerCallHandler<ReqT, RespT> next) {  
  
        ServerCall<ReqT, RespT> forwardingCall =  
            new ForwardingServerCall.SimpleForwardingServerCall<>(call) {  
                @Override  
                public void sendHeaders(Metadata responseHeaders) {  
                    responseHeaders.put(SERVER_HEADER, "grpc-spring-boot");  
                    super.sendHeaders(responseHeaders); // ì‹¤ì œ ì „ì†¡  
                }  
            };  
  
        return next.startCall(forwardingCall, headers);  
    }  
}
```
- `ForwardingServerCall`
    - ServerCallì„ ê°ì‹¸ì„œ ë™ì‘ì„ ê°€ë¡œì±„ê³ , ì¼ë¶€ë§Œ ë°”ê¾¼ ë’¤ ì›ë˜ ë™ì‘ì„ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ”ë°ì½”ë ˆì´í„° íŒ¨í„´ì˜ í´ë˜ìŠ¤
- `sendHeaders()`
    - ì‘ë‹µì„ ë³´ë‚¼ ë•Œ ê°€ì¥ ë¨¼ì € ë‚´ë ¤ê°€ëŠ” í—¤ë” ì „ì†¡ ë©”ì„œë“œ

### 2. ìš”ì²­
```shell
grpcurl -v -plaintext -H "authorization: zinzo" localhost:9097 HelloService/SayHello
```
- `-v` ì˜µì…˜ì„ í†µí•´ í—¤ë” ì •ë³´ë„ í•¨ê»˜ ì¡°íšŒ
##### ì‘ë‹µ
```
Resolved method descriptor:
rpc SayHello ( .HelloRequest ) returns ( .HelloResponse );

Request metadata to send:
authorization: zinzo

Response headers received:
content-type: application/grpc
grpc-accept-encoding: gzip
x-server: grpc-spring-boot // <- í™•ì¸ ê°€ëŠ¥

Response contents:
{
  "message": "ë°˜ê°‘ìŠµë‹ˆë‹¤~ zinzoë‹˜"
}

Response trailers received:
(empty)
Sent 0 requests and received 1 response
```

## 1-7. íŠ¸ë ˆì¼ëŸ¬ ì „ì†¡ ë°©ë²•
íŠ¸ë ˆì¼ëŸ¬ë€ ì‘ë‹µì´ ëë‚  ë•Œ, ë§ˆì§€ë§‰ì— ì˜¤ëŠ” ë©”íƒ€ë°ì´í„°ë¥¼ ì˜ë¯¸í•˜ëŠ”ë°, ì£¼ë¡œ ì—ëŸ¬ ì½”ë“œë‚˜ ì¶”ê°€ ì •ë³´ë¥¼ ë‹´ì„ ë•Œ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.

íŠ¸ë ˆì¼ëŸ¬ê°€ ë¹„ì–´ ìˆì„ ê²½ìš° ì•„ë˜ì™€ ê°™ì´ ì‘ë‹µì´ ë‚´ë ¤ì˜¤ê²Œ ë©ë‹ˆë‹¤.
```
Response trailers received:
(empty)
```

### 1) ì„œë¹„ìŠ¤ì—ì„œ íŠ¸ë ˆì¼ëŸ¬ ì‘ë‹µì£¼ê¸°
```java
@Override  
public void sayHello(HelloRequest request, StreamObserver<HelloResponse> responseObserver) {  
    if (!StringUtils.hasText(request.getName())) {  
        Metadata trailers = new Metadata();  
        Metadata.Key<String> ERROR_CODE =  
            Metadata.Key.of("x-error-code", Metadata.ASCII_STRING_MARSHALLER);  
        trailers.put(ERROR_CODE, "VAL_001");  
  
        responseObserver.onError(  
            Status.INVALID_ARGUMENT  
                .withDescription("ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.")  
                .asRuntimeException(trailers) // <- ì—¬ê¸°ì„œ íŠ¸ë ˆì¼ëŸ¬ í¬í•¨  
        );  
        return;  
    }
    ...
```

### 2) ìš”ì²­
```
grpcurl -v -plaintext localhost:9097 HelloService/SayHello
```
##### ì‘ë‹µ
```
Resolved method descriptor:
rpc SayHello ( .HelloRequest ) returns ( .HelloResponse );

Request metadata to send:
(empty)

Response headers received:
(empty)

Response trailers received:
content-type: application/grpc
x-error-code: VAL_001 // <- í™•ì¸ ê°€ëŠ¥
Sent 0 requests and received 0 responses
ERROR:
  Code: InvalidArgument
  Message: ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.
```
Response trailers received í•­ëª©ì— ì»¤ìŠ¤í…€ ë©”íƒ€ë°ì´í„°ë¥¼ ì„¤ì •í•œ ê²ƒì´ ë³´ì…ë‹ˆë‹¤.

# 2. Deadline, Timeout
HTTP/2ë¥¼ ì´ìš©í•´ì„œ gRPCê°€ ë™ì‘í•˜ì§€ë§Œ, HTTPì˜ Timeoutê³¼ ë‹¬ë¦¬ Deadlineì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.
í´ë¼ì´ì–¸íŠ¸ê°€ "ì´ RPC ìš”ì²­ì€ ì–¸ì œê¹Œì§€ ëë‚˜ì•¼ í•¨"ì´ë¼ê³  ë§ˆê° ì‹œê°ì„ ì§€ì •í•˜ê³ , ê·¸ ì‹œê°„ì„ ë„˜ê¸¸ ê²½ìš° ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ëª¨ë‘ ìš”ì²­ì„ **ìë™ ì·¨ì†Œ**í•©ë‹ˆë‹¤.

- Timeout : ìƒëŒ€ì ì¸ ì‹œê°„
    - ex, timeout = 5 (5ì´ˆ ë‚´ë¡œ ìš”ì²­ì„ ì²˜ë¦¬í•  ê²ƒ)
- Deadline : ì ˆëŒ€ì ì¸ ì‹œê°„
    - ex, deadline = 2025-05-05T23:00:00 (25ë…„ 5ì›” 5ì¼ 23ì‹œê¹Œì§€ ìš”ì²­ì„ ì²˜ë¦¬í•  ê²ƒ)

gRPCëŠ” ë‚´ë¶€ì ìœ¼ë¡œ timeoutì„ deadlineìœ¼ë¡œ ë³€í™˜í•´ ë™ì‘í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

## 2-1. Deadlineì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ 
HTTPì˜ timeoutì€ **í´ë¼ì´ì–¸íŠ¸ ë‹¨ì—ì„œë§Œ ë™ì‘**í•©ë‹ˆë‹¤.
gRPCì˜ deadlineì€ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ëª¨ë‘ê°€ ì•Œ ìˆ˜ ìˆê³ , ì¤‘ê°„ í”„ë¡ì‹œë„ ê°™ì´ deadlineì„ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ ë•ë¶„ì—, ë¶ˆí•„ìš”í•œ ë¦¬ì†ŒìŠ¤ ì†Œë¹„ë¥¼ ì¤„ì´ê³ , ì¤‘ê°„ ê³„ì¸µë„ í•´ë‹¹ ìš”ì²­ì´ íƒ€ì„ì•„ì›ƒì„ì„ ì¸ì§€í•˜ê³  ë¹ ë¥´ê²Œ ëŠì–´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 2-2. ë™ì‘ ë°©ì‹
- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ì— ìš”ì²­í•  ë•Œ, ë°ë“œë¼ì¸ ì‹œê°„ì„ í•¨ê»˜ ì„œì •
- gRPC í”„ë ˆì„ì—ëŠ” `grpc-timeout` ë©”íƒ€ ë°ì´í„°ê°€ í¬í•¨ë¨
- ì„œë²„ì—ì„œëŠ” Contextë¥¼ í†µí•´ ì·¨ì†Œ ì‹ í˜¸ í™•ì¸ ê°€ëŠ¥
- ì§€ì •ëœ Deadline ì‹œê°„ì´ ì§€ë‚˜ë©´ ì„œë²„ëŠ” ì‘ì—… ì¤‘ì´ë”ë¼ë„, **DeadlineExceeded** í˜¹ì€ **Cancelled**ìƒíƒœë¡œ ì¢…ë£Œ

## 2-3. Deadline ì‘ë‹µ í™•ì¸í•˜ê¸°
### 1) ì„œë²„ì—ì„œ ì˜¤ëœ ì‹œê°„ ê±¸ë¦¬ëŠ” ê¸°ëŠ¥ êµ¬í˜„
```java
@Override  
public void sayHello(HelloRequest request, StreamObserver<HelloResponse> responseObserver) {  
    try {  
        Thread.sleep(30000);  
    } catch (InterruptedException e) {  
        throw new RuntimeException(e);  
    }
    ...
```

### 2) Deadline ì„¤ì •í•˜ê³  ìš”ì²­
```shell
grpcurl -plaintext \
  -max-time 1 \
  -d '{"name":"zinzo"}' \
  localhost:9097 HelloService/SayHello
```
##### ì‘ë‹µ
```
ERROR:
  Code: DeadlineExceeded
  Message: context deadline exceeded
```

- DeadlineExceeded : í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì˜ deadline ì´ˆê³¼í–ˆì„ ë•Œ
- Cancelled : í´ë¼ì´ì–¸íŠ¸ê°€ ì§ì ‘ ì·¨ì†Œí–ˆì„ ë•Œ

## 2-4. ë‚¨ì€ Deadline ì‹œê°„ í™•ì¸í•˜ê¸°
Deadline ì‹œê°„ì„ í™•ì¸í•¨ìœ¼ë¡œì¨, ì˜¤ë˜ ê±¸ë¦¬ëŠ” ë¡œì§ì—ì„œ ì¤‘ê°„ì¤‘ê°„ ì²´í¬í•˜ì—¬ ë¹ ë¥´ê²Œ ì¤‘ë‹¨í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
ê·¸ë ‡ì§€ ì•Šìœ¼ë©´, deadlineì€ ì´ˆê³¼í–ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ì„œë²„ ìŠ¤ë ˆë“œëŠ” ê³„ì† ë‚­ë¹„ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.
```java
@Override  
public void sayHello(HelloRequest request, StreamObserver<HelloResponse> responseObserver) {  
    Deadline deadline = Context.current().getDeadline();  
    if (deadline != null) {  
        System.out.println("ìš”ì²­ ë§ˆê° ì‹œê°: " + deadline);  
        System.out.println("ë‚¨ì€ ì‹œê°„(ms): " + deadline.timeRemaining(TimeUnit.MILLISECONDS));  
    }  
  
    try {  
        Thread.sleep(30000);  
    } catch (InterruptedException e) {  
        throw new RuntimeException(e);  
    }  
  
    if (Context.current().isCancelled()) {  
        System.out.println("âš ï¸ í´ë¼ì´ì–¸íŠ¸ê°€ ì·¨ì†Œí–ˆê±°ë‚˜, ë°ë“œë¼ì¸ì´ ì§€ë‚¨");  
    }
```
- getDeadline() : ìš”ì²­ì´ ì–¸ì œê¹Œì§€ ìœ íš¨í•œì§€ í™•ì¸ ê°€ëŠ¥
- isCanclled() : ì·¨ì†Œ/ì´ˆê³¼ ì—¬ë¶€ í™•ì¸ ê°€ëŠ¥
##### ìš”ì²­
```shell
grpcurl -plaintext \
  -max-time 1 \
  -d '{"name":"zinzo"}' \
  localhost:9097 HelloService/SayHello
```
##### ì‘ë‹µ
```
ERROR:
  Code: DeadlineExceeded
  Message: context deadline exceeded
```
##### ì½˜ì†”
```
ìš”ì²­ ë§ˆê° ì‹œê°: 0.774270250s from now
ë‚¨ì€ ì‹œê°„(ms): 768
âš ï¸ í´ë¼ì´ì–¸íŠ¸ê°€ ì·¨ì†Œí–ˆê±°ë‚˜, ë°ë“œë¼ì¸ì´ ì§€ë‚¨
```

---
# ëŠë‚€ì 
í—¤ë”ë¥¼ ë¬´ì¡°ê±´ ì¸í„°ì…‰í„°ì—ì„œ ì²˜ë¦¬í•´ì•¼ ëœë‹¤ëŠ” ê²Œ ë‚¯ì„¤ê³  ë¶ˆí¸í•˜ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
ë˜í•œ ë©”íƒ€ë°ì´í„°ë¥¼ ë°›ê¸° ìœ„í•´ì„œëŠ” íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ ë°›ëŠ” ê²ƒì´ ì•„ë‹Œ ì»¨í…ìŠ¤íŠ¸ë¡œ ì½”ë“œ ë¸”ë¡ ë‚´ì—ì„œ ë°›ëŠ” ì  ì—­ì‹œ ê´œì°®ë‚˜ ì‹¶ì—ˆìŠµë‹ˆë‹¤.

ì•„ë¬´ë˜ë„ í•­ìƒ HTTP í”„ë¡œí† ì½œì„ ì´ìš©í•œ ê°œë°œë§Œ í•´ì˜¤ë‹¤ê°€ ìƒˆë¡œìš´ í”„ë¡œí† ì½œ ê°œë°œì„ í•˜ë ¤ë‹¤ ë³´ë‹ˆ ë‚¯ì„  ê²ƒì´ ìƒë‹¹íˆ ë§ì€ ê²ƒ ê°™ì€ë°ìš”.

ê·¸ì¤‘ì—ì„œë„ ì‹ ê¸°í–ˆë˜ ì ìœ¼ë¡œëŠ”, ë°ë“œë¼ì¸ì´ ì„œë²„ ìª½ì—ì„œë„ ì¸ì§€ê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ ê·¸ë§Œí¼ ì‹ ê²½ ì¨ì„œ ê°œë°œí• ê²Œ ë§ì•„ì§€ê² ë‹¤ëŠ” ë¶€ë‹´ìœ¼ë¡œë„ ë‹¤ê°€ì˜¤ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ë‹¤ìŒì—ëŠ” ë¯¸ë£¨ê³  ë¯¸ë¤˜ë˜ í´ë¼ì´ì–¸íŠ¸ ì„œë²„ë¥¼ ì§ì ‘ êµ¬í˜„í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

